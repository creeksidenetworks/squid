http_port 3128
cache_dir ufs /var/spool/squid 10240 16 256

# ACL for servers that need MS365/OIDC access
# Add your server IPs here (one per line or in CIDR notation)
acl ms365_allowed_ips src "/etc/squid/ms365_allowed_ips.list"
acl ms365_domains dstdomain "/etc/squid/ms365_oidc_domains.list"
acl strict_allowed_domains dstdomain "/etc/squid/strict_whitelisted_domains.list"

# Only allow download methods (GET and CONNECT) to whitelisted domains
acl download_methods method GET CONNECT

# Allow MS365 access for specific IPs (including POST for OIDC auth)
acl ms365_auth_methods method GET POST CONNECT HEAD
http_access allow ms365_allowed_ips ms365_domains ms365_auth_methods

# Allow general download methods to other whitelisted domains
http_access allow strict_allowed_domains download_methods

# And finally deny all other access to this proxy
http_access deny all


